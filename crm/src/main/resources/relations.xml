<?xml version="1.0" encoding="UTF-8"?>

<relations>
	<relation>
		<from>account</from>
		<name>contactlistOfaccount</name>
		<display>医生列表</display>
		<sql>select a.* from contact as a where a.accountId=?</sql>
		<to>contact</to>
		<relationKey>accountId</relationKey>
	</relation>
	
	<relation>
		<from>crmuser</from>
		<name>crmuser2account</name>
		<display>客户关系</display>
		<sql>
		select * from (select contact_generalization_target_pl.val as product_target_val\,contact.*\,account.name as accountName_val\,account.id as accountName
		                  from contact\,contactcrmuser\,account \,contact_generalization_target_pl 
		                  where contactcrmuser.crmuserId=? AND  contact.id != -1 AND
			                    contactcrmuser.contactId=contact.id AND account.id=contact.accountId AND 
			                    contact_generalization_target_pl.id= product_target 
			                    order by whenadded DESC) as
			                    aContact
		</sql>
		<to>contact</to>
		<relationKey>accountId</relationKey>
		<reactions>
		   <reaction>
		       <name>createContact</name>
		       <display>增加</display>
		        <url>contact</url>
		        <paramName>contactId</paramName>
		   </reaction>
		</reactions>
	</relation>
	
	<relation>
		<from>crmuser</from>
		<name>crmuser2activity</name>
		<display>拜访</display>
		<sql>select a.* from activity as a inner join crmuser as b on a.crmuserId=b.id where b.id=?</sql>
		<to>activity</to>
	</relation>
<!-- 	<relation>
		<from>contact</from>
		<name>accountOfContact</name>
		<display>所属医院</display>
		<sql>select b.* from contact as a\,account as b where a.id=? AND b.id=a.accountId</sql>
		<to>account</to>
	</relation> -->
	
	
	<relation>
		<from>contact</from>
		<name>visitingOfContact</name>
		<display>拜访</display>
		<sql>select * from (select *\,activity_type as act_type\,status as act_status from activity where contactId=?) as aActivity </sql>
		<to>activity</to>
	</relation>
	
	<relation>
		<from>dealerAccount</from>
		<name>dealerContactlistOfdealerAccount</name>
		<display>联系人列表</display>
		<sql>select a.* from dealerContact as a where a.dealerAccountId=?</sql>
		<to>dealerContact</to>
	</relation>
	
	<relation>
		<from>dealerContact</from>
		<name>dealerAccountOfdealerContact</name>
		<display>所属经销商</display>
		<sql>select b.* from dealerContact as a\,dealerAccount as b where a.id=? AND b.id=a.dealerAccountId</sql>
		<to>dealerAccount</to>
	</relation>
	
    <relation>
		<from>activity</from>
		<name>crmuser2activity</name>
		<display>参与此次拜访的销售代表</display>
		<sql>select crmuser.* from crmuser\,activity where activity.crmuserId=crmuser.Id AND activity.Id=?</sql>
		<to>crmuser</to>
	</relation>
	
</relations>