<?xml version="1.0" encoding="UTF-8"?>

<relations>
	<relation>
		<from>account</from>
		<name>contactlistOfaccount</name>
		<display>医生列表</display>
		<sql>select a.* from contact as a where a.accountId=?</sql>
		<to>contact</to>
		<relationKey>accountId</relationKey>
	</relation>
	
<!-- 	<relation>
		<from>crmuser</from>
		<name>crmuser2contact</name>
		<display>医生关系</display>
		<sql>
		select * from (select contact_generalization_target_pl.val as product_target_val\,contact.*\,account.name as accountName_val\,account.id as accountName
		                  from contact\,contactcrmuser\,account \,contact_generalization_target_pl 
		                  where contactcrmuser.crmuserId=? AND  contact.id != -1 AND
			                    contactcrmuser.contactId=contact.id AND account.id=contact.accountId AND 
			                    contact_generalization_target_pl.id= product_target 
			                    order by whenadded DESC) as
			                    aContact
		</sql>
		<to>contact</to>
		<relationKey>accountId</relationKey>
		<reactions>
		   <reaction>
		       <name>createContact</name>
		       <display>添加</display>
		        <url>contact</url>
		        <paramName>contactId</paramName>
		   </reaction>
		</reactions>
	</relation> -->
	
	<relation>
		<from>crmuser</from>
		<name>crmuser2activity</name>
		<display>拜访</display>
		<sql>
		select * from (select activity.*\,activity.activity_type as
			                             act_type\,activity.status as act_status\, activity.contactId as
			                             contactName\, contact.accountId as accountName\,activity_event_type_pl.val as event_type_val\,account.name as accountName_val\,
			                             contact.name as contactname_val  
			                from activity\,contact\,activitycrmuser\,activity_event_type_pl\,account 
			                where contact.id= activity.contactId AND activitycrmuser.activityId=activity.id AND activitycrmuser.crmuserId=? AND 
			                activity_event_type_pl.id=event_type AND account.id=contact.accountId) as
			aActivity
		</sql>
		<to>activity</to>
	</relation>
<!-- 	<relation>
		<from>contact</from>
		<name>accountOfContact</name>
		<display>所属医院</display>
		<sql>select b.* from contact as a\,account as b where a.id=? AND b.id=a.accountId</sql>
		<to>account</to>
	</relation> -->
	
	

	<relation>
		<from>contact</from>
		<name>accountInfoOfContact</name>
		<display>医院信息</display>
		<sql>select * from (select account.* from contact\,account where contact.id=? AND account.id=contact.accountId) as act </sql>
		<to>account</to>
	</relation>
	
	<relation>
		<from>contact</from>
		<name>visitingOfContact</name>
		<display>拜访</display>
		<sql>select * from (select *\,activity_type as act_type\,status as act_status from activity where contactId=?) as aActivity </sql>
		<to>activity</to>
	</relation>
	
    <relation>
		<from>activity</from>
		<name>crmuser2activity</name>
		<display>参与此次拜访的销售代表</display>
		<sql>select crmuser.* from crmuser\,activity where activity.crmuserId=crmuser.Id AND activity.Id=?</sql>
		<to>crmuser</to>
	</relation>
	
</relations>