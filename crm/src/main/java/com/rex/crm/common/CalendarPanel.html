<wicket:panel>
	<script>
		$(document).ready(function() {
			$('#calendar').fullCalendar({
				// put your options and callbacks here
				header : {
					left : 'prev,next today',
					center : 'title',
					right : 'month,agendaWeek,agendaDay'
				},

				height : 500,
				selectable : true,
				selectHelper : true,
				editable : true,
				
				monthNames : [ '1月', '2月', '3月', '4月', '5月', '6月', '7月', '8月', '9月', '10月', '11月', '12月' ],
		          monthNamesShort : [ '1月', '2月', '3月', '4月', '5月', '6月', '7月', '8月', '9月', '10月', '11月', '12月' ],
		          dayNames : [ '星期一', '星期二', '星期三', '星期四', '星期五', '星期六', '星期天' ],
		          dayNamesShort : [ '周一', '周二', '周三', '周四', '周五', '周六', '周日' ],
		          columnFormat : {
		              month : 'ddd',
		              week : 'M/d ddd',
		              day : 'M/d dddd'
		          },
		          titleFormat : {
		              month : 'yyyy年MMMM',
		              week : "yyyy年",
		              day : 'yyyy年'
		          },
		          buttonText : {
		              today : '今天',
		              month : '月',
		              week : '周',
		              day : '日'
		          },
		          eventAfterRender : function( event, element, view ) {
		              //cell.prepend('<span class=\"newEventSpan pull-left\" style="display:none"><a class="newEventLink" href="#">新建</a></span>');
		              //cell.css("min-height", "");
		              //element.children().first().append("<i class=\"icon-tasks pull-right\"></i>");
		          },
		          eventClick: function(calEvent, jsEvent, view) {
		            console.log(calEvent);
		           /*  if(calEvent.act_type == 1){
		                location.href = "activityDetailPage.html#seg?activityId="+calEvent.id+"&parentpage="+url.attr("relative");
		            }else if(calEvent.act_type == 2 || calEvent.act_type == 3){
		                location.href = "meetingDetailPage.html#seg?activityId="+calEvent.id+"&parentpage="+url.attr("relative");
		            } */
		            
		           // location.href = "/"+context_name+'/mount/eventViewer?eventid='+calEvent.id;
		            location.href = '../../mount/eventViewer?eventid='+calEvent.id;

		          },
		          dayClick : function(date, allDay, jsEvent, view) {

		              if (allDay) {
		                  console.log('Clicked on the entire day: ' + date);
		              } else {
		                  console.log('Clicked on the slot: ' + date);
		              }

		              console.log('Coordinates: ' + jsEvent.pageX + ',' + jsEvent.pageY);

		              console.log('Current view: ' + view.name);

		              // change the day's background color just for fun
		              // $(this).css('background-color', 'red');

		              var selecteddate = $.fullCalendar.formatDate(date, "yyyy-MM-dd");
		             
		              console.log(selecteddate);
		              //location.href = '../offline/calendarEventForm.html#seg?startdate='+selecteddate+"&parentpage="+url.attr("relative");
		              //location.href = "/"+context_name+'/mount/createEventPage?startdate='+selecteddate;
		              location.href ='../../mount/createEventPage?startdate='+selecteddate;

		          }
				
				//events : JSON.parse(user_event_data)

			});
            userInfo = JSON.parse(userInfo);
            console.log("user info is:");
            console.log(userInfo);
            renderCalendarWithDataRemotely(userInfo);

            function renderCalendarWithDataRemotely(ui) {
                ACTIVITY_UTIL.queryRemoteActivities(ui,function(data) {
                    var calendarEvents = ACTIVITY_UTIL.convertActivityTableData2CallendarEvents(data);
                    //console.log(calendarEvents);
                    //renderCalendar(calendarEvents);
                    appendCalendarEvent(calendarEvents);
                }, function(status) {
                    //renderCalendarWithDataLocally();
                    console.log("failed to get remote event data");
                });//END of queryRemoteActivities
            }

            function appendCalendarEvent(event) {
                var eventlen = event.length;
                for ( var i = 0; i < eventlen; i++) {
                    $('#calendar').fullCalendar('renderEvent', event[i], true);
                }
                $('#calendar').fullCalendar('render');
            }


            renderSelect4Inferiors();
            function renderSelect4Inferiors(){

                CRMUSER_UTIL.getInferiorsRemotely(userInfo.id,function(data){

                    var objs =  [];
                    for(var i=0;i<data.length;i++){
                        var obj = {};
                        obj.name = data[i].name;
                        obj.id =   data[i].id;
                        objs.push(obj);
                    }

                    $('#crmuser_select').select2({
                        data : {
                            results : objs ,
                            text : 'name'
                        },
                        formatSelection : selectformat,
                        formatResult : selectformat
                    });


                    $("#crmuser_select").on("change", function(e){
                        console.log("change " + JSON.stringify({
                            val : e.val,
                            added : e.added,
                            removed : e.removed,
                            defaultContact : e.defaultContact
                        }));

                        var userIdex = {};
                        userIdex.id = e.val;
                        renderCalendarWithDataRemotely(userIdex);

                    });


                },function(error){
                      console.log("failed to render select2");
                });


            }

            function selectformat(item) {
                return item.name;
            }

		});
	</script>
	<script src="js/activityutil.js"></script>
	<script src="js/activityUI.js"></script>
	<script src="js/contactutil.js"></script>
	<script src="js/crmuserutil.js"></script>
	<script src='js/dataclient2.js'></script>

	<div class="container-fluid">
		<div class="row-fluid">
			<div class="span12">

				<div class="control-group">
					<label class="control-label" for="inforior">下属：</label>
					<div class="controls">
						<input type="hidden" id="crmuser_select" style="width: 200px" tabindex="-1" class="select2-offscreen input">
					</div>
				</div>

			</div>
		</div>
		<div class="row-fluid">
			<div class="span11">
				<div>
					<div id="calendar"></div>
				</div>
			</div>

			<div class="span1">

				<span class="label" style="background-color: #2B60DE">拜访</span> 
				<span class="label" style="background-color: #E18B6B">外部会议</span> 
				<span class="label" style="background-color: #ff8c00">内部会议</span>
				<span class="label" style="background-color: #6698FF">其他</span>
				<hr />
				<span class="label" style="background-color: #659EC7">完成</span>

			</div>
		</div>
	</div>
</wicket:panel>